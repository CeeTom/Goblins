<!DOCTYPE html>
<head>
    <script type="text/javascript">
        "use strict";

        class Eventer {
            constructor() {
                this.listeners = {};
            }

            addEventListener(name, f) {
                if (!this.listeners[name])
                    this.listeners[name] = [];
                this.listeners[name].push(f);
            }

            removeEventListener(name, f) {
                if (this.listeners[name]) {
                    this.listeners[name] =
                        this.listeners[name].filter(v => v != f);
                }
            }

            dispatchEvent(name, o) {
                if (this.listeners[name])
                    for (let f in this.listeners[name])
                        f(o);
                return true;
            }
        }

        function loadIdNamePairs(endPoint) {
            return new Promise(function(res, rej) {
                let xhr = new XMLHttpRequest();
                xhr.onload = () => { res(JSON.parse(xhr.responseText)); }
                xhr.onerror = () => { rej(xhr.responseText); }
            });
        }

        function attackSelector(gameInfo, attacks) {
            let select = document.createElement("select");
            let newOption = document.createElement("option");
            newOption.innerHTML = "[New Attack]";
            select.appendChild(newOption);
            for (let i = 0; i < attacks.length; i++) {
                let option = document.createElement("option");
                option.innerHTML = attacks[i].Name;
                option.attack = attack;
                select.appendChild(option);
            }
            return select;
        }

        function attackDisplay(gameInfo, attack) {
            let display = document.createElement("div");

            let id = document.createElement("span");
            id.innerHTML = attack.Id.toString();
            display.appendChild(id);

            let name = document.createElement("input");
            name.type = "text";
            name.value = attack.Name;
            display.appendChild(name);

            let strCost = document.createElement("input");
            strCost.type = "number";
            strCost.value = attack.StrengthCost.toString();
            display.appendChild(strCost);

            let magCost = document.createElement("input");
            magCost.type = "number";
            magCost.value = attack.MagicCost.toString();
            display.appendChild(magCost);

            let dmgs = new DamageList(gameInfo, attack.Damages);
            display.appendChild(dmgs.element);

            let selfDmgs = new DamageList(gameInfo, attack.SelfDamages);
            display.appendChild(selfDmgs.element);

            let saveButton = document.createElement("button");
            button.innerHTML = "Save";
            display.appendChild(saveButton);

            return { element: display };
        }

        class DamageLi extends Eventer {
            constructor(gameInfo, damage) {
                let li = document.createElement("li");
                let selector = damageSelector(gameInfo, damages[i]);
                let deleteButton = document.createElement("button");
                deleteButton.innerHTML = "Remove";
                deleteButton.addEventListener('click',
                    () => this.dispatchEvent('item-removed', selector));
                li.appendChild(selector.element);
                li.appendChild(deleteButton);

                this.selector = selector;
                this.element = li;
            }
        }

        class DamageList {
            addDamage(damage) {
                let li = new DamageLi(this.gameInfo, damage);
                this.currDamages.push(li);
                this.element.insertBefore(li, this.addLi);
            }

            asDamages() {
                return this.currDamages.map(v => v.selector.asDamage());
            }

            constructor(gameInfo, damages) {
                this.gameInfo = gameInfo;
                this.currDamages = [];
                this.element = document.createElement("ul");
                this.addLi = document.createElement("li");

                function newDamage() {
                    return {
                        Type: 0,
                        Amount: 0,
                        Pierce: 0,
                        Statuses: [],
                        ScalingFunc: 0,
                        ScalingStat: 0,
                        ScalingMulti: 0,
                        Variance: 0,
                    };
                }

                let addButton = document.createElement("button");
                addButton.innerHTML = "Add Damage";

                addButton.addEventListener("click",
                    () => this.addDamage(newDamage()));

                this.addLi.appendChild(addButton);
                this.element.appendChild(this.addLi);

                for (let i = 0; i < damages.length; i++)
                    this.addDamage(damages[i]);
            }
        }

        function damageSelector(gameInfo, damage) {

            return {
                element: null,
                asDamage: () => null,
            };
        }

        function statusList(gameInfo, statuses) {

        }

        function statusSelector(gameInfo, status) {

        }

        function scalingStatSelector(gameInfo, stat) {

        }

        function scalingFuncSelector(gameInfo, scaleF) {

        }

        function populateInterface() {
        }
    </script>
</head>
<body>
    <h1>Goblins: Attack Editor</h2>
    <div id="editor"></div>
</body>
